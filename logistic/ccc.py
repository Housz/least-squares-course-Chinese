import matplotlib.pyplot as plt
import numpy as np
import math

samples = [[0.04, 0.21, 1.0], [0.04, 0.29, 1.0], [0.07, 0.21, 1.0], [0.07, 0.91, 1.0], [0.08, 0.95, 1.0], [0.09, 0.23, 1.0], [0.09, 0.44, 1.0], [0.09, 0.64, 1.0], [0.09, 0.68, 1.0], [0.11, 0.27, 1.0], [0.11, 0.60, 1.0], [0.15, 0.49, 1.0], [0.16, 0.65, 1.0], [0.17, 0.59, 1.0], [0.20, 0.68, 1.0], [0.23, 0.52, 1.0], [0.24, 0.39, 1.0], [0.29, 0.32, 1.0], [0.29, 0.43, 1.0], [0.31, 0.28, 1.0], [0.31, 0.29, 1.0], [0.32, 0.24, 1.0], [0.32, 0.25, 1.0], [0.33, 0.44, 1.0], [0.33, 0.48, 1.0], [0.36, 0.33, 1.0], [0.37, 0.11, 1.0], [0.39, 0.16, 1.0], [0.44, 0.20, 1.0], [0.45, 0.31, 1.0], [0.47, 0.33, 1.0], [0.52, 0.19, 1.0], [0.53, 0.20, 1.0], [0.53, 0.25, 1.0], [0.63, 0.19, 1.0], [0.64, 0.04, 1.0], [0.73, 0.17, 1.0], [0.73, 0.20, 1.0], [0.88, 0.15, 1.0], [0.91, 0.15, 1.0], [0.17, 0.93, 1.0], [0.20, 0.80, 1.0], [0.27, 0.81, 1.0], [0.31, 0.64, 1.0], [0.33, 0.56, 1.0], [0.35, 0.83, 1.0], [0.37, 0.49, 1.0], [0.40, 0.43, 1.0], [0.41, 0.64, 1.0], [0.44, 0.61, 1.0], [0.44, 0.79, 1.0], [0.45, 0.60, 1.0], [0.45, 0.92, 1.0], [0.47, 0.56, 1.0], [0.47, 0.92, 1.0], [0.49, 0.68, 1.0], [0.49, 0.71, 1.0], [0.52, 0.44, 1.0], [0.53, 0.52, 1.0], [0.55, 0.77, 1.0], [0.56, 0.33, 1.0], [0.56, 0.93, 1.0], [0.57, 0.87, 1.0], [0.59, 0.68, 1.0], [0.60, 0.92, 1.0], [0.63, 0.56, 1.0], [0.63, 0.76, 1.0], [0.63, 0.83, 1.0], [0.64, 0.25, 1.0], [0.64, 0.77, 1.0], [0.64, 0.84, 1.0], [0.65, 0.27, 1.0], [0.65, 0.80, 1.0], [0.67, 0.55, 1.0], [0.67, 0.57, 1.0], [0.68, 0.92, 1.0], [0.69, 0.63, 1.0], [0.69, 0.64, 1.0], [0.71, 0.23, 1.0], [0.71, 0.84, 1.0], [0.71, 0.87, 1.0], [0.73, 0.65, 1.0], [0.75, 0.28, 1.0], [0.75, 0.39, 1.0], [0.76, 0.21, 1.0], [0.77, 0.40, 1.0], [0.81, 0.56, 1.0], [0.83, 0.24, 1.0], [0.83, 0.51, 1.0], [0.84, 0.21, 1.0], [0.84, 0.80, 1.0], [0.85, 0.81, 1.0], [0.89, 0.24, 1.0], [0.89, 0.51, 1.0], [0.89, 0.67, 1.0], [0.93, 0.55, 1.0], [0.93, 0.79, 1.0], [0.96, 0.44, 1.0], [0.96, 0.55, 1.0], [0.96, 0.60, 1.0]]
labels = [0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.]

def p(x, w):
    return 1./(1.+math.exp(-np.dot(x,w)))

#samples = [[.5,.7,1.],[.1,.5,1.],[.3,.6,1.],[.2,.8,1.],
#           [.17,.17,1.],[.2,.3,1.],[.3,.4,1.],[.05,.2,1.],
#           [.2,.3,1.],[.8,.3,1.],[.5,.2,1.],[.7,.2,1.],
#           [.9,.1,1.],[.8,.4,1.],[.6,.5,1.],[.5,.4,1.]]
#labels = [0.,0.,0.,0.,0.,0.,0.,0.,0.,1.,1.,1.,1.,1.,1.,1.]

n = len(samples)
X = np.matrix(samples)
y = np.matrix(labels).T
wk = np.matrix([[.3], [.7], [-.02]]) # small random numbers

for _ in range(250):
    pk = np.matrix([p(xi,wk) for xi in samples]).T
    Vk = np.matrix(np.diag([pk[i,0]*(1.-pk[i,0]) for i in range(n)]))
    wk += np.linalg.inv(X.T*Vk*X)*(X.T*(y-pk))

print(wk)

fig,ax = plt.subplots(1, figsize=(6.40,6.40),dpi=100)

res = 100
x0 = np.arange(0, 1., 1./res)
x1 = np.arange(0, 1., 1./res)

Y = [[p([a,b,1.], wk) for a in x0] for b in x1]

X0, X1 = np.meshgrid(x0, x1)
plt.contourf(X0, X1, Y, 100, cmap=plt.cm.RdYlGn)
plt.colorbar()
plt.contour(X0, X1, Y,levels=[.49995, .50005], colors='k', linestyles='--')


for sample, label in zip(samples,labels):
    c = 'g'
    if (label<.5): c = 'r'
    plt.scatter(sample[0], sample[1], color=c, edgecolors='black')

plt.tight_layout()
#plt.gca().axes.get_yaxis().set_visible(False)
#plt.gca().axes.get_xaxis().set_visible(False)
plt.show()

